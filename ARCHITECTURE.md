# System Architecture Diagram

## ğŸ—ï¸ Hybrid Surat Management System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT APPLICATIONS                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                               â”‚                                     â”‚
â”‚    ğŸ“± Mobile App              â”‚     ğŸ’» Web Admin Panel             â”‚
â”‚    (React Native Expo)        â”‚     (Next.js)                      â”‚
â”‚                               â”‚                                     â”‚
â”‚    Users: Pimpinan, Staf      â”‚     Users: Admin Only              â”‚
â”‚                               â”‚                                     â”‚
â”‚    Features:                  â”‚     Features:                      â”‚
â”‚    â€¢ OAuth Login              â”‚     â€¢ OAuth Login                  â”‚
â”‚    â€¢ View Letters             â”‚     â€¢ User Management              â”‚
â”‚    â€¢ View Dispositions        â”‚     â€¢ Team Management              â”‚
â”‚    â€¢ Team Chat (Read)         â”‚     â€¢ Letter CRUD                  â”‚
â”‚    â€¢ PDF Viewer               â”‚     â€¢ Send Dispositions            â”‚
â”‚    â€¢ Push Notifications       â”‚     â€¢ Team Chat (Send)             â”‚
â”‚                               â”‚     â€¢ Reports                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â–¼
                       HTTPS / REST API
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ğŸš€ EXPRESS.JS API                           â”‚
â”‚                        (Node.js Backend)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    ğŸ” Authentication Layer                    â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â€¢ Clerk Authentication Platform                             â”‚ â”‚
â”‚  â”‚    - Universal Auth (Google, Email, etc)                     â”‚ â”‚
â”‚  â”‚    - JWT Validation via Clerk Middleware                     â”‚ â”‚
â”‚  â”‚    - Session & User Management by Clerk                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   ğŸ›¡ï¸ Authorization Layer                      â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â€¢ RBAC Middleware                                           â”‚ â”‚
â”‚  â”‚  â€¢ Role Validation (ADMIN, PIMPINAN, STAF)                   â”‚ â”‚
â”‚  â”‚  â€¢ Resource Ownership Checks                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      ğŸ“‹ API Routes                            â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  /auth/*           - OAuth & Authentication                  â”‚ â”‚
â”‚  â”‚  /api/users/*      - User Management (CRUD)                  â”‚ â”‚
â”‚  â”‚  /api/teams/*      - Team Management (CRUD)                  â”‚ â”‚
â”‚  â”‚  /api/letters/*    - Letter Management (CRUD)                â”‚ â”‚
â”‚  â”‚  /api/dispositions/* - Disposition Management                â”‚ â”‚
â”‚  â”‚  /api/messages/*   - Team Chat                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    ğŸ”§ Utility Layers                          â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â€¢ Error Handling                                            â”‚ â”‚
â”‚  â”‚  â€¢ Input Validation                                          â”‚ â”‚
â”‚  â”‚  â€¢ CORS Configuration                                        â”‚ â”‚
â”‚  â”‚  â€¢ Request Logging                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ—„ï¸ Database    â”‚  â”‚  â˜ï¸ File Storage  â”‚  â”‚  ğŸ”” Real-time     â”‚
â”‚                 â”‚  â”‚                  â”‚  â”‚                   â”‚
â”‚  PostgreSQL     â”‚  â”‚  Cloudinary      â”‚  â”‚  Pusher Channels  â”‚
â”‚  (Neon DB)      â”‚  â”‚                  â”‚  â”‚                   â”‚
â”‚                 â”‚  â”‚  â€¢ PDF Storage   â”‚  â”‚  â€¢ Chat Messages  â”‚
â”‚  ğŸ“Š Prisma ORM  â”‚  â”‚  â€¢ Public URLs   â”‚  â”‚  â€¢ Notifications  â”‚
â”‚                 â”‚  â”‚  â€¢ 10MB limit    â”‚  â”‚  â€¢ Status Updates â”‚
â”‚  Models:        â”‚  â”‚  â€¢ CDN Delivery  â”‚  â”‚                   â”‚
â”‚  â€¢ User         â”‚  â”‚                  â”‚  â”‚  Channels:        â”‚
â”‚  â€¢ Team         â”‚  â”‚                  â”‚  â”‚  â€¢ team-{id}      â”‚
â”‚  â€¢ TeamMember   â”‚  â”‚                  â”‚  â”‚  â€¢ user-{id}      â”‚
â”‚  â€¢ Letter       â”‚  â”‚                  â”‚  â”‚  â€¢ letters        â”‚
â”‚  â€¢ Disposition  â”‚  â”‚                  â”‚  â”‚                   â”‚
â”‚  â€¢ TeamMessage  â”‚  â”‚                  â”‚  â”‚  Events:          â”‚
â”‚                 â”‚  â”‚                  â”‚  â”‚  â€¢ new-message    â”‚
â”‚                 â”‚  â”‚                  â”‚  â”‚  â€¢ new-dispositionâ”‚
â”‚                 â”‚  â”‚                  â”‚  â”‚  â€¢ chat-lock      â”‚
â”‚                 â”‚  â”‚                  â”‚  â”‚  â€¢ new-letter     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Data Flow Diagrams

### 1. Authentication Flow (Clerk)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚â”€â”€â”€â”€1â”€â”€â”€>â”‚   Clerk    â”‚â”€â”€â”€â”€2â”€â”€â”€>â”‚ Identity     â”‚         â”‚ Database â”‚
â”‚(Web/Mobile)â”‚        â”‚  Platform  â”‚         â”‚ Providers    â”‚         â”‚(Neon DB) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â–²                    â”‚ â–²                       â”‚
     â”‚                    â”‚ â”‚                       â”‚
     â”‚                3.User authenticates          â”‚
     â”‚                    â”‚ â”‚                       â–¼
     â”‚                    â”‚ â””â”€â”€â”€â”€â”€â”€4. Callbackâ”€â”€â”€â”€â”€â”€â”˜
     â”‚                    â”‚
     â”‚                    5. Clerk issues JWT       â”‚
     â”‚                    â”‚
     â”‚                    6. Client stores JWT      â”‚
     â”‚                    â”‚
     â”‚                    7. API requests with JWTâ”€â”€â”¼â”€â”€â”€â”€â”€>â”‚ Express API â”‚
     â”‚                                              â”‚      â”‚ (Clerk Middleware)
     â”‚                                              â”‚      â”‚
     â”‚                                              â”‚      â”‚ 8. Validate JWT & Sync User
     â”‚                                              â”‚      â”‚ 9. Access Database
     â”‚                                              â”‚      â”‚10. Return Data
     â”‚                                              â”‚      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Steps:
1. Client authenticates via Clerk (Google, Email, etc)
2. Clerk handles OAuth/identity provider
3. Clerk issues JWT to client
4. Client includes JWT in API requests
5. Express API validates JWT via Clerk middleware
6. User data is synced/queried in database as needed
7. Data returned to client
```

### 2. Letter Creation with PDF Upload

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚â”€â”€â”€â”€1â”€â”€â”€>â”‚  Express   â”‚â”€â”€â”€â”€3â”€â”€â”€>â”‚  Cloudinary  â”‚         â”‚ Database â”‚
â”‚  Client  â”‚         â”‚   API      â”‚         â”‚              â”‚         â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â–²                    â”‚ â–²                       â”‚                       â”‚
     â”‚                    â”‚ â”‚                       â”‚                       â”‚
     â”‚              2. Validate                     â”‚                       â”‚
     â”‚               JWT & Role                     â”‚                       â”‚
     â”‚                    â”‚ â”‚                       â–¼                       â”‚
     â”‚                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€4. Upload PDFâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚
     â”‚                    â”‚                         â”‚                       â”‚
     â”‚                    â”‚<â”€â”€â”€â”€5. Return URLâ”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
     â”‚                    â”‚                                                 â”‚
     â”‚                    6. Save Letter Data with PDF URL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                    â”‚                                                 â”‚
     â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€7. Letter Createdâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                    â”‚
     â”‚                    8. Trigger Pusher Event
     â”‚                    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€9. Return Letter Data with PDF URLâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Steps:
1. Admin uploads letter with PDF file
2. Express validates JWT and admin role
3. Multer processes multipart form data
4. File buffer sent to Cloudinary
5. Cloudinary returns secure URL
6. Letter saved to database with PDF URL
7. Database confirms creation
8. Real-time event triggered
9. Client receives letter data
```

### 3. Disposition Creation & Notification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin/  â”‚â”€â”€â”€â”€1â”€â”€â”€>â”‚  Express   â”‚â”€â”€â”€â”€4â”€â”€â”€>â”‚    Pusher    â”‚         â”‚ Database â”‚
â”‚ Pimpinan â”‚         â”‚   API      â”‚         â”‚   Channels   â”‚         â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â–²                    â”‚ â–²                       â”‚                       â”‚
     â”‚              2. Validate JWT                 â”‚                       â”‚
     â”‚               & Check Role                   â”‚                       â”‚
     â”‚                    â”‚ â”‚                       â”‚                       â”‚
     â”‚            3. Create Disposition â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                    â”‚ â”‚                       â”‚                       â”‚
     â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€5. Disposition IDâ”€â”€â”€â”˜
     â”‚                    â”‚                         â”‚
     â”‚                    â””â”€â”€â”€â”€6. Trigger Eventâ”€â”€â”€â”€>â”‚
     â”‚                    â”‚      (new-disposition)  â”‚
     â”‚                    â”‚                         â””â”€â”€â”€â”€>7. Push to Client
     â”‚                    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€8. Return Disposition Dataâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Steps:
1. Admin/Pimpinan sends disposition to user/team
2. Express validates role (Admin or Pimpinan)
3. Disposition created in database
4. Pusher notified
5. Database confirms creation
6. Pusher event triggered
7. Real-time notification sent to recipient
8. Creator receives confirmation
```

### 4. Team Chat Message Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚â”€â”€â”€â”€1â”€â”€â”€>â”‚  Express   â”‚â”€â”€â”€â”€4â”€â”€â”€>â”‚    Pusher    â”‚         â”‚ Database â”‚
â”‚  Client  â”‚         â”‚   API      â”‚         â”‚   Channels   â”‚         â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â–²                    â”‚ â–²                       â”‚                       â”‚
     â”‚                    â”‚ â”‚                       â”‚                       â”‚
     â”‚              2. Validate                     â”‚                       â”‚
     â”‚              â€¢ JWT Token                     â”‚                       â”‚
     â”‚              â€¢ Admin Role                    â”‚                       â”‚
     â”‚              â€¢ Chat Not Locked               â”‚                       â”‚
     â”‚                    â”‚ â”‚                       â”‚                       â”‚
     â”‚            3. Save Message â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                    â”‚ â”‚                       â”‚                       â”‚
     â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€5. Message IDâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                    â”‚                         â”‚
     â”‚                    â””â”€â”€â”€6. Trigger Eventâ”€â”€â”€â”€â”€>â”‚
     â”‚                    â”‚     (new-message)       â”‚
     â”‚                    â”‚                         â””â”€â”€â”€â”€>7. Broadcast
     â”‚                    â”‚                              to Team Members
     â””â”€â”€â”€â”€â”€â”€â”€â”€8. Return Message Dataâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ Pimpinan â”‚  â”‚   Staf   â”‚
                         â”‚(Read-Only)â”‚  â”‚(Read-Only)â”‚
                         â””â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”˜
                               â”‚             â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€ 7. Receive Message

Steps:
1. Admin sends message to team chat
2. Express validates: JWT, Admin role, chat unlocked
3. Message saved to database
4. Pusher notified
5. Database returns message ID
6. Pusher event triggered
7. Real-time broadcast to all team members
8. Admin receives confirmation
```

## ğŸ¯ Role-Based Access Pattern

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Request Flow                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ 1. JWT Authentication â”‚
                  â”‚    (authenticateToken)â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Token Valid?    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         Yes  â”‚  No
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 2. Role Check     â”‚    â”‚ 401 Error    â”‚
        â”‚    (requireRole)  â”‚    â”‚ Unauthorized â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Has Required Role?   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             Yes    â”‚    No
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Execute    â”‚    â”‚ 403 Error    â”‚
â”‚    Route      â”‚    â”‚  Forbidden   â”‚
â”‚    Handler    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Return Data   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Role Hierarchy:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ADMIN                                        â”‚
â”‚ â€¢ All permissions                            â”‚
â”‚ â€¢ User management                            â”‚
â”‚ â€¢ Team management                            â”‚
â”‚ â€¢ Letter CRUD                                â”‚
â”‚ â€¢ Send messages                              â”‚
â”‚ â€¢ Lock/unlock chat                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Can do everything PIMPINAN can
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PIMPINAN                                     â”‚
â”‚ â€¢ View letters                               â”‚
â”‚ â€¢ Send dispositions                          â”‚
â”‚ â€¢ View team messages (read-only)             â”‚
â”‚ â€¢ Update disposition status                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Can do everything STAF can
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAF                                         â”‚
â”‚ â€¢ View assigned letters                      â”‚
â”‚ â€¢ View their dispositions                    â”‚
â”‚ â€¢ View team messages (read-only)             â”‚
â”‚ â€¢ Update disposition status (their own)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—„ï¸ Database Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Database Schema                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     User      â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)       â”‚
â”‚ email         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ name          â”‚             â”‚
â”‚ role          â”‚             â”‚
â”‚ provider      â”‚             â”‚
â”‚ providerId    â”‚             â”‚
â”‚ avatarUrl     â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
        â”‚                     â”‚
        â”‚ 1:N                 â”‚ N:1
        â”‚                     â”‚
        â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  TeamMember   â”‚             â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
â”‚ id (PK)       â”‚             â”‚
â”‚ userId (FK)   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ teamId (FK)   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
                              â”‚ N:1
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
                    â”‚     Team      â”‚
                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                    â”‚ id (PK)       â”‚
                    â”‚ name          â”‚
                    â”‚ description   â”‚
                    â”‚ isChatLocked  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ 1:N
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                            â”‚
              â–¼                            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  TeamMessage     â”‚         â”‚  Disposition    â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚ id (PK)          â”‚         â”‚ id (PK)         â”‚
    â”‚ teamId (FK)â”€â”€â”€â”€â”€â”€â”˜         â”‚ teamId (FK)â”€â”€â”€â”€â”€â”˜
    â”‚ senderId (FK)              â”‚ letterId (FK)â”€â”€â”€â”
    â”‚ content                    â”‚ senderId (FK)   â”‚
    â”‚ createdAt                  â”‚ recipientId(FK) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ status          â”‚
                                 â”‚ notes           â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚ N:1
                                          â”‚
                                          â–¼
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚    Letter      â”‚
                                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                                 â”‚ id (PK)        â”‚
                                 â”‚ type           â”‚
                                 â”‚ referenceNumberâ”‚
                                 â”‚ subject        â”‚
                                 â”‚ sender         â”‚
                                 â”‚ recipient      â”‚
                                 â”‚ letterDate     â”‚
                                 â”‚ fileUrl        â”‚
                                 â”‚ description    â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Relationships:
â€¢ User â†â†’ TeamMember â†â†’ Team (Many-to-Many)
â€¢ User â†â”€ TeamMessage (One-to-Many)
â€¢ Team â†â”€ TeamMessage (One-to-Many)
â€¢ User â†â”€ Disposition (One-to-Many, as sender)
â€¢ User â†â”€ Disposition (One-to-Many, as recipient)
â€¢ Team â†â”€ Disposition (One-to-Many)
â€¢ Letter â†â”€ Disposition (One-to-Many)
```

---

**Use these diagrams to understand the system architecture! ğŸ“Š**
